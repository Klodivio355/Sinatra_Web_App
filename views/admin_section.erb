<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" type="text/css" href="css/admin_section.css">
        <script src="js/admin_functions.js"></script>
        <title>Administrator Access</title>
        <meta http-equiv="refresh" content="300">
    </head>
    <body>
        <%= erb :header %>
        <h1>Administrator System</h1>
        <form method="get">
            Search:<input type="text" name="search" value="<%=h params[:search] %>" required/>
            <input type="submit" name="submit" value="Update"/>
        </form>
        <br>
        <div id="bodyDiv">
            <table id="searchTable">
                <tr>
                    <th width="120">User</th>
                    <th width="600">Tweet</th>
                    <th width="200">Time</th>
                    <th>Options</th>
                </tr>
                <% unless @tweets.nil? %>
                    <% if @tweets.length == 0 %>
                        <p>No tweets found.</p>
                    <% else %>
                        <% @tweets.each do |tweet| %>
                            <tr>
                                <td>
                                    <a href="<%= tweet.user.uri %>" target="_blank">
                                        <%= tweet.user.screen_name %>
                                    </a>
                                </td>
                                <td>
                                    <%= tweet.text %>
                                </td>
                                <td>
                                    <%= tweet.created_at %>
                                </td>
                                <td align="center">
                                    <div id="menu">
                                        <select onchange="menuChange(this)">
                                            <option selected>Select...</option>
                                            <option id="book" value="<%= tweet.user.screen_name %>">Book Ride</option>
                                            <option id="reply" value="<%= tweet.uri %>">Reply (External)</option>
                                            <option id="warn" value="">Apply Warning</option>
                                            <option id="block" value="">Block User</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        <% end %>
                    <% end %>
                <% end %>
            </table>
            
        <div id="bookingForm">
            <form action="/updateBooking" method="post">
                <label for="handleIn">User Handle</label>
                <input type="text" maxLength="15" name="handleIn" id="handleIn" value="<%= @queryHandle %>" required/><br><br>
                
                <label for="regIn">Car Registration</label>
                <input type="text" maxLength="7" name="regIn" id="regIn" value="<%= @queryReg %>" required/><br><br>
                
                <label for="startTimeIn">Start Time</label>
                <input type="time" name="startTimeIn" id="startTimeIn" value="<%= @queryTime %>" required/>
                
                <label for="endTimeIn">End Time</label>
                <input type="time" name="endTimeIn" id="endTimeIn"/><br><br>
                
                <label for="dateIn">Date</label>
                <input type="date" name="dateIn" id="dateIn" value="<%= @queryDate %>" required/><br><br>
                
                <label for="startPosIn">Start Location</label>
                <input type="text" name="startPosIn" id="startPosIn" value="<%= @queryStart %>" required/>
                
                <label for="endPosIn">End Location</label>
                <input type="text" name="endPosIn" id="endPosIn"/><br><br>
                
                <label for="priceIn">Price</label>
                <input type="number" step="0.01" name="priceIn" defaultValue="0" id="priceIn"/><br><br>
                
                <input type="submit" name="enterForm" value="Save"/>
                <input type="submit" name="enterForm" value="Submit"/>
                <input type="reset" value="Cancel"/>
            </form>
        </div>
            
        <div>
            <% unless @car_results.nil? %>  
                <% if @car_results.length == 0 %>
                    <p>No cars found.</p>
                <% else %>
                    <table id="carTable">
                        <tr>
                            <th>Reg.</th>
                            <th>Type</th>
                            <th>Seats</th>
                            <th>Available?</th>
                        </tr>
                        <% @car_results.each do |car| %>
                            <tr>
                                <td name = "reg" value="<%= car[0] %>">
                                    <%= car[0] %>
                                </td>
                                <td>
                                    <%= car[1] %>
                                </td>
                                <td>
                                    <%= car[2] %>
                                </td>
                                <td>
                                    <% if(car[3] == 0) %>
                                        <p id="free">Free</p>
                                    <% else %>
                                    <form action="/admin_section" method="get">
                                        <button type="submit" id="busy" name="busy" value="<%= car[0] %>">Busy</button>
                                    </form>
                                    <% end %>
                                </td>
                            </tr>
                        <% end %>
                    </table>
                <% end %>
            <% end %>
        </div>
    </div>
    <%= erb :footer %>